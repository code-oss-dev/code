variables:
  VSCODE_BUILD_VERBOSE: true
  System.Debug: true

steps:

- task: NodeTool@0
  inputs:
    versionSpec: "8.9.1"

- task: geeklearningio.gl-vsts-tasks-yarn.yarn-installer-task.YarnInstaller@2
  inputs:
    versionSpec: "1.3.2"

- script: |
    apt-get update
    apt-get install -y libxkbfile-dev pkg-config libsecret-1-dev libxss1 libgconf-2-4

- script: |
    git checkout -f master
    yarn
    npm run gulp -- electron-x64

- script: |
    npm run gulp -- hygiene
    ./node_modules/.bin/tsc -p ./src/tsconfig.monaco.json --noEmit
    npm run gulp -- vscode-linux-x64-min
  name: build

- script: |
    ./scripts/test.sh --build --reporter dot
  name: test
